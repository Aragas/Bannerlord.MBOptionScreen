<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title> | MCM Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=" | MCM Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Aragas/Bannerlord.MBOptionScreen/blob/dev/docs/articles/MCMv3/mcmv3.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../images/MCM-48.svg" alt="MCM">
            MCM
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<h2 id="overview">Overview</h2>
<p>MCMv3 consists of three core libraries:</p>
<ul>
<li><strong>MCMv3</strong> - abstraction layer. Includes v1/v2 Attribute API and a Fluent Builder API that allows to define settings at runtime.</li>
<li><strong>MCMv3.Implementation</strong> - common implementations.</li>
<li><strong>MCMv3.UI</strong> - GauntletUI implementations.</li>
</ul>
<p>MCMv3 also provides compatibility layers for other mods:</p>
<ul>
<li><strong>MCMv3.Implementation.MBO</strong> - MBOv1/MCMv2.</li>
<li><strong>MCMv3.Implementation.ModLib</strong> - ModLib, pre 1.3 and post 1.3.</li>
</ul>
<p>Both compatibility layers replace the original libraries to ensure maximum compatibility with MCMv3.</p>
<h2 id="supported-api">Supported API</h2>
<p>MCMv3 support 5 API sets:</p>
<ul>
<li><strong>MCMv3</strong> - main API.</li>
<li><strong>MBOv1</strong> - MBOptionScreen v1.1.15 (Requires <strong>MCM.Implementation.MBO</strong>)</li>
<li><strong>MBOv2</strong>/<strong>MCMv2</strong> - v2.0.4-v2.0.11 (Requires <strong>MCM.Implementation.MBO</strong>)</li>
<li><strong>ModLibV1</strong> - v1.0.0-v1.0.2       (Requires <strong>MCM.Implementation.ModLib</strong>)</li>
<li><strong>ModLibV13</strong> - v1.3.0-v1.4.0      (Requires <strong>MCM.Implementation.ModLib</strong>)</li>
</ul>
<h2 id="using-with-your-mods">Using with your mods</h2>
<p>You have two options as to how to use MCMv3:</p>
<ul>
<li>Integrate MCMv3 into your mod by using NuGet packet <strong><a href="https://www.nuget.org/packages/Bannerlord.MCM.Integrated">Bannerlord.MCM.Integrated</a></strong></li>
<li>Directly depend on the Nexus standalone mod and use NuGet packet <strong><a href="https://www.nuget.org/packages/Bannerlord.MCM">Bannerlord.MCM</a></strong></li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>Integration is no longer supported and should be replaced with MCMv4 or newer.</p>
</div>
<p>By integrating MCMv3 you won't need to depend on the Nexus standalone package. It will be loaded with your mod and should pick up the settings from your mod and any other mod that uses MCMv3. ModLib and MBO/MCM compatibility will not be provided.
<strong>The v3 version still has sometimes issues with the integration system due to game limitations regarding being unable to load multiple versions of the same assembly (DLL). While those issues are not fixed I would suggest to depend on MCM package/Nexus mod if possible. I at least can guarantee that if the standalone MCM mod is installed, any bugs related to MCM are fixed without your need to update the integrated package. The next big release, v4, will not offer an integrated version in favor of the determinism and stability of relying upon a standalone mod.</strong><br>
You also need to include this to your SubModules.xml!</p>
<pre><code class="lang-xml">&lt;SubModule&gt;
  &lt;Name value=&quot;MCMv3 Integrated Loader&quot;/&gt;
  &lt;DLLName value=&quot;MCMv3.dll&quot;/&gt;
  &lt;SubModuleClassType value=&quot;MCM.IntegratedLoaderSubModule&quot;/&gt;
  &lt;Tags/&gt;
&lt;/SubModule&gt;
</code></pre>
<p>By depending on the standalone module the experience is basically the same as to ModLib. You only use the MCMv3 abstraction layer and the Nexus standalone mod will ensure that your settings are displayed.</p>
<h2 id="types-of-settings">Types of settings</h2>
<p>As of now, Mod Option mods provided <strong><em>Global</em></strong> options that are shared across different games/saves.</p>
<p>MCMv3 introduces a second type of settings - <strong><em>PerCharacter</em></strong>, it will be unique for each character and will be shared across saves with the same character.</p>
<h2 id="included-settings-formats-and-implementing-your-own">Included Settings Formats and implementing your own</h2>
<p><strong>MCMv3.Implementation</strong> provides <code>json</code> and <code>xml</code> file formats.<br>
You can define your own file formats and take full control of how the settings are saved/loaded by implementing an interface that... implements @&quot;MCM.Abstractions.Settings.Formats.ISettingsFormat?text=ISettingsFormat&quot; and @&quot;MCM.Abstractions.IDependency?text=IDependency&quot;.</p>
<pre><code class="lang-csharp">public interface IYamlSettingsFormat : ISettingsFormat, IDependency
{

}
[Version(&quot;e1.0.0&quot;,  1)]
internal class YamlSettingsFormat : IYamlSettingsFormat 
{

}
</code></pre>
<h2 id="presets">Presets</h2>
<p>The setting support custom presets!<br>
<img src="../../resources/presets.png" alt=""></p>
<h3 id="attribute-api">Attribute API</h3>
<p>The Attribute API based settings will provide a 'Default' preset that can be used to revert the options to their default values.<br>
To override the 'Default' preset or add your custom presets, override <code>GetAvailablePresets()</code>, here's an example.</p>
<pre><code class="lang-csharp">public override IDictionary&lt;string, Func&lt;BaseSettings&gt;&gt; GetAvailablePresets()
{
    var basePresets = base.GetAvailablePresets(); // include the 'Default' preset that MCM provides
    basePresets.Add(&quot;Reverse&quot;, () =&gt; new CustomSettings()
    {
        Property1 = false,
        Property2 = true
    });
    basePresets.Add(&quot;False&quot;, () =&gt; new CustomSettings()
    {
        Property1 = false,
        Property2 = false
    });
    basePresets.Add(&quot;True&quot;, () =&gt; new CustomSettings()
    {
        Property1 = true,
        Property2 = true
    });
    return basePresets;
}
</code></pre>
<h3 id="fluent-api">Fluent API</h3>
<p>The Fluent Builder does not support Presets in v3, but it's a planned feature for v4!</p>
<h2 id="localization">Localization</h2>
<h3 id="attribute-api-1">Attribute API</h3>
<p>Both property Name and HintText support game's localization system, this means that you can use such code</p>
<pre><code class="lang-csharp">[SettingPropertyBool(&quot;{=DvfsSDF}Property Sample&quot;, HintText = &quot;{=DnfhFD}Sample Hint Text.&quot;)]
[SettingPropertyGroup(&quot;{=JFgbsdg}Group Sample&quot;)]
</code></pre>
<p>You also can use the localization system for nested groups!</p>
<pre><code class="lang-csharp">[SettingPropertyGroup(&quot;{=JFgbsdg}Group Sample\{=GDgsdfj}Nested Group Sample&quot;)]
</code></pre>
<h2 id="inotifypropertychanged">INotifyPropertyChanged</h2>
<p>The settings implement the <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.componentmodel.inotifypropertychanged">INotifyPropertyChanged</a> interface.</p>
<p>MCM subscribes to it and will refresh the UI if any value has changed.</p>
<p>MCM will also trigger PropertyChanged event when the setting are saved by providing <code>BaseSettings.SaveTriggered</code> constant with value <code>SAVE_TRIGGERED</code>.</p>
<h2 id="iref">IRef</h2>
<p><strong>IRef</strong> is an interface that acts as a link to the actual values that classes like Fluent Builder uses.<br>
MCMv3 has two implementations:</p>
<ul>
<li>@&quot;MCM.Abstractions.Ref.PropertyRef?text=PropertyRef&quot; - links to an actual property (<code>PropertyRef(PropertyInfo propInfo, object instance)</code>).</li>
<li>@&quot;MCM.Abstractions.Ref.ProxyRef`1?text=ProxyRef&lt;T&gt;&quot; - links to get/set actions (<code>ProxyRef(Func&lt;T&gt; getter, Action&lt;T&gt;? setter)</code>) that will set/return whatever you want.</li>
</ul>
<h2 id="defining-settings">Defining Settings</h2>
<p><img src="../../resources/properties.png" alt=""></p>
<ul>
<li>Check <a href="mcmv3-attributes.html">this page</a> for using the Attribute definition</li>
<li>Check <a href="mcmv3-fluent-builder.html">this page</a> for using the Fluent Builder</li>
</ul>
<h2 id="example-of-settings-definition">Example of Settings definition</h2>
<h3 id="attribute-api-2">Attribute API</h3>
<pre><code class="lang-csharp">internal sealed class MCMUISettings : AttributeGlobalSettings&lt;MCMUISettings&gt; // AttributePerCharacterSettings&lt;MCMUISettings&gt;
{
    private bool _useStandardOptionScreen = false;

    public override string Id =&gt; &quot;MCMUI_v3&quot;;
    public override string DisplayName =&gt; $&quot;MCM UI Impl. {typeof(MCMUISettings).Assembly.GetName().Version.ToString(3)}&quot;;
    public override string FolderName =&gt; &quot;MCM&quot;;
    public override string Format =&gt; &quot;json&quot;;

    [SettingPropertyBool(&quot;Use Standard Option Screen&quot;, Order = 1, RequireRestart = false, HintText = &quot;Use standard Options screen instead of using an external.&quot;)]
    [SettingPropertyGroup(&quot;General&quot;)]
    public bool UseStandardOptionScreen
    {
        get =&gt; _useStandardOptionScreen;
        set
        {
            if (_useStandardOptionScreen != value)
            {
                _useStandardOptionScreen = value;
                OnPropertyChanged();
            }
        }
    }
}
</code></pre>
<h3 id="fluent-api-1">Fluent API</h3>
<pre><code class="lang-csharp">bool _boolValue = false;
int _intValue = 1;
float _floatValue = 0f;
string _stringValue = string.Empty;
var builder = new DefaultSettingsBuilder(&quot;test_v1&quot;, &quot;Test Fluent Settings&quot;)
    .SetFormat(&quot;xml&quot;)
    .SetFolderName(string.Empty)
    .SetSubFolder(string.Empty)
    .CreateGroup(&quot;Testing 1&quot;, groupBuilder =&gt; groupBuilder
        .AddBool(&quot;Check Box&quot;, new ProxyRef&lt;bool&gt;(() =&gt; _boolValue, o =&gt; _boolValue = o), boolBuilder =&gt; boolBuilder
            .SetHintText(&quot;Test&quot;)))
    .CreateGroup(&quot;Testing 2&quot;, groupBuilder =&gt; groupBuilder
        .AddInteger(&quot;Integer&quot;, 0, 10, new ProxyRef&lt;int&gt;(() =&gt; _intValue, o =&gt; _intValue = o), integerBuilder =&gt; integerBuilder
            .SetHintText(&quot;Testing&quot;))
        .AddFloatingInteger(&quot;Floating Integer&quot;, 0, 10, new ProxyRef&lt;float&gt;(() =&gt; _floatValue, o =&gt; _floatValue = o), floatingBuilder =&gt; floatingBuilder
            .SetRequireRestart(true)
            .SetHintText(&quot;Test&quot;)))
    .CreateGroup(&quot;Testing 3&quot;, groupBuilder =&gt; groupBuilder
        .AddText(&quot;Test&quot;, new ProxyRef&lt;string&gt;(() =&gt; _stringValue, o =&gt; _stringValue = o), null));

var globalSettings = builder.BuildAsGlobal();
globalSettings.Register();
globalSettings.Unregister();

var perCharacterSettings = builder.BuildAsPerCharacter();
perCharacterSettings.Register();
perCharacterSettings.Unregister();
</code></pre>
<h2 id="translating-mcm">Translating MCM</h2>
<p>Just create a module and include in the module folder root folders <code>ModuleData/Languages</code> and include the translations of the following files:</p>
<ul>
<li><a href="https://github.com/Aragas/Bannerlord.MBOptionScreen/tree/v3/src/Localization/std_MCM.xml">std_MCM.xml</a></li>
<li><a href="https://github.com/Aragas/Bannerlord.MBOptionScreen/tree/v3/src/Localization/std_MCM_Implementation.xml">std_MCM_Implementation.xml</a></li>
<li><a href="https://github.com/Aragas/Bannerlord.MBOptionScreen/tree/v3/src/Localization/std_MCM_MBO.xml">std_MCM_MBO.xml</a></li>
<li><a href="https://github.com/Aragas/Bannerlord.MBOptionScreen/tree/v3/src/Localization/std_MCM_ModLib.xml">std_MCM_ModLib.xml</a></li>
<li><a href="https://github.com/Aragas/Bannerlord.MBOptionScreen/tree/v3/Localization/std_MCM_UI.xml">std_MCM_UI.xml</a></li>
</ul>
<p>The game will load them automatically!</p>
<h2 id="migrating-to-v3">Migrating to v3</h2>
<h3 id="modlib-v1-100-102">ModLib v1 (1.0.0-1.0.2)</h3>
<ul>
<li>[<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.xml.xmlelement">XmlElement</a>] attribute is not required</li>
<li>Namespace of <code>SettingPropertyAttribute</code> changed to <a class="xref" href="../../api/MCM.Abstractions.Attributes.v1.html">MCM.Abstractions.Attributes.v1</a></li>
<li><code>SettingPropertyAttribute.EditableMinValue</code> and <code>SettingPropertyAttribute.EditableMaxValue</code> were removed</li>
<li><code>SettingPropertyAttribute.HintText</code> is an attribute optional parameter</li>
<li>MCM's <code>SettingPropertyAttribute</code> introduces new properties <code>Order</code> and <code>RequireRestart</code></li>
<li>Namespace of <code>SettingPropertyGroupAttribute</code> changed to <a class="xref" href="../../api/MCM.Abstractions.Attributes.html">MCM.Abstractions.Attributes</a></li>
<li><code>SettingPropertyGroupAttribute.IsMainToggle</code> is an attribute optional parameter</li>
<li><code>ModLib.SettingsBase</code> needs to be changed to @&quot;MCM.Abstractions.Settings.Base.Global.AttributeGlobalSettings`1?text=AttributeGlobalSettings&lt;T&gt;&quot;</li>
<li><code>ModName</code> was renamed to <code>DisplayName</code></li>
<li><code>ModuleFolderName</code> was renamed to <code>FolderName</code>, no longer required</li>
</ul>
<h3 id="modlib-v13-13-and-beyond">ModLib v13 (1.3 and beyond)</h3>
<ul>
<li>[<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.xml.xmlelement">XmlElement</a>] attribute is not required</li>
<li>Namespace of <code>SettingPropertyAttribute</code> changed to <a class="xref" href="../../api/MCM.Abstractions.Attributes.v1.html">MCM.Abstractions.Attributes.v1</a></li>
<li><code>SettingPropertyAttribute.EditableMinValue</code> and <code>SettingPropertyAttribute.EditableMaxValue</code> were removed</li>
<li><code>SettingPropertyAttribute.HintText</code> is an attribute optional parameter</li>
<li>MCM's <code>SettingPropertyAttribute</code> introduces new properties <code>Order</code> and <code>RequireRestart</code></li>
<li>Namespace of <code>SettingPropertyGroupAttribute</code> changed to <a class="xref" href="../../api/MCM.Abstractions.Attributes.html">MCM.Abstractions.Attributes</a></li>
<li><code>SettingPropertyGroupAttribute.IsMainToggle</code> is an attribute optional parameter</li>
<li><code>ModLib.Definitions.SettingsBase</code> needs to be changed to @&quot;MCM.Abstractions.Settings.Base.Global.AttributeGlobalSettings`1?text=AttributeGlobalSettings&lt;T&gt;&quot;</li>
<li><code>ModName</code> was renamed to <code>DisplayName</code></li>
<li><code>ModuleFolderName</code> was renamed to <code>FolderName</code>, no longer required</li>
</ul>
<h3 id="mbov1-mbo-1015-or-lower">MBOv1 (MBO 1.0.15 or lower)</h3>
<ul>
<li>Attributes changed its namespace from <code>MBOptionScreen.Attributes</code> to <code>MCM.Abstractions.Attributes</code></li>
<li><code>MBOptionScreen.Settings.AttributeSettings&lt;T&gt;</code> needs to be changed to @&quot;MCM.Abstractions.Settings.Base.Global.AttributeGlobalSettings`1?text=AttributeGlobalSettings&lt;T&gt;&quot;</li>
<li><code>ModName</code> was renamed to <code>DisplayName</code></li>
<li><code>ModuleFolderName</code> was renamed to <code>FolderName</code>, no longer required</li>
</ul>
<h3 id="mcmv2-mcm-v2010-or-lower">MCMv2 (MCM v2.0.10 or lower)</h3>
<ul>
<li>Attributes changed its namespace from <code>MBOptionScreen.Attributes</code> to <a class="xref" href="../../api/MCM.Abstractions.Attributes.html">MCM.Abstractions.Attributes</a></li>
<li><code>MBOptionScreen.Settings.AttributeSettings&lt;T&gt;</code> needs to be changed to @&quot;MCM.Abstractions.Settings.Base.Global.AttributeGlobalSettings`1?text=AttributeGlobalSettings&lt;T&gt;&quot;</li>
<li><code>ModName</code> was renamed to <code>DisplayName</code></li>
<li><code>ModuleFolderName</code> was renamed to <code>FolderName</code>, no longer required</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Aragas/Bannerlord.MBOptionScreen/blob/dev/docs/articles/MCMv3/mcmv3.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © 2020-2024 Aragas
        </div>
      </div>
    </footer>
  </body>
</html>
